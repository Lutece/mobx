<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Writing async actions | MobX</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.4.3">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-edit-link/plugin.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-anchors/plugin.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
    

        
    
    
    <link rel="next" href="../best/react-performance.html" />
    
    
    <link rel="prev" href="../best/store.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="7.3" data-basepath=".." data-revision="Thu Dec 28 2017 00:14:30 GMT+0900 (KST)">
    

<div class="book-summary">
    <div class="book-search" role="search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" >
            
            <span><b>1.</b> Introduction to MobX</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="intro/overview.html">
            
                
                    <a href="../intro/overview.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        The Gist of MobX
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="intro/concepts.html">
            
                
                    <a href="../intro/concepts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Concepts &amp; Principles
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="refguide/api.html">
            
                
                    <a href="../refguide/api.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        API overview
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="refguide/observable.html">
            
                
                    <a href="../refguide/observable.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        observable
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="refguide/observable-decorator.html">
            
                
                    <a href="../refguide/observable-decorator.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        @observable
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="refguide/computed-decorator.html">
            
                
                    <a href="../refguide/computed-decorator.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        (@)computed
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="refguide/autorun.html">
            
                
                    <a href="../refguide/autorun.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        autorun
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="refguide/observer-component.html">
            
                
                    <a href="../refguide/observer-component.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                        (@)observer
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="refguide/action.html">
            
                
                    <a href="../refguide/action.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                        action
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" >
            
            <span><b>3.</b> Observable Types</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="refguide/object.html">
            
                
                    <a href="../refguide/object.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        objects
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="refguide/array.html">
            
                
                    <a href="../refguide/array.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        arrays
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="refguide/map.html">
            
                
                    <a href="../refguide/map.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        maps
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="refguide/boxed.html">
            
                
                    <a href="../refguide/boxed.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        boxed values
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="best/react.html">
            
                
                    <a href="../best/react.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Understanding what MobX reacts to
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="best/decorators.html">
            
                
                    <a href="../best/decorators.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        How to (not) use decorators
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" >
            
            <span><b>6.</b> Resources</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="faq/blogs.html">
            
                
                    <a href="../faq/blogs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Tutorials, videos and blogs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="faq/related.html">
            
                
                    <a href="../faq/related.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        Related Projects
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="faq/examples.html">
            
                
                    <a href="../faq/examples.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        Examples projects
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="faq/boilerplates.html">
            
                
                    <a href="../faq/boilerplates.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        Boilerplates
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="faq/faq.html">
            
                
                    <a href="../faq/faq.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.5.</b>
                        
                        Frequently Asked Questions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" >
            
            <span><b>7.</b> Tips &amp; Tricks</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="best/pitfalls.html">
            
                
                    <a href="../best/pitfalls.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Common Pitfalls &amp; Best Practices
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="best/store.html">
            
                
                    <a href="../best/store.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        Defining data stores
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="7.3" data-path="best/actions.html">
            
                
                    <a href="../best/actions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.3.</b>
                        
                        Writing async actions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="best/react-performance.html">
            
                
                    <a href="../best/react-performance.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.4.</b>
                        
                        Optimizing React components
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.5" data-path="best/devtools.html">
            
                
                    <a href="../best/devtools.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.5.</b>
                        
                        DevTools
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.6" data-path="best/syntax.html">
            
                
                    <a href="../best/syntax.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.6.</b>
                        
                        ES5 / ES6 / TypeScript syntax
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.7" data-path="best/stateless-HMR.html">
            
                
                    <a href="../best/stateless-HMR.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.7.</b>
                        
                        Stateless Components and Hot Module Reloading
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" >
            
            <span><b>8.</b> Utility functions</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="refguide/autorun-async.html">
            
                
                    <a href="../refguide/autorun-async.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        autorunAsync
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="refguide/extending.html">
            
                
                    <a href="../refguide/extending.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        Atom &amp; Reaction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="refguide/create-transformer.html">
            
                
                    <a href="../refguide/create-transformer.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        createTransformer
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="refguide/expr.html">
            
                
                    <a href="../refguide/expr.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        expr
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="refguide/extend-observable.html">
            
                
                    <a href="../refguide/extend-observable.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.5.</b>
                        
                        extendObservable
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.6" data-path="refguide/is-observable.html">
            
                
                    <a href="../refguide/is-observable.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.6.</b>
                        
                        isObservable
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.7" data-path="refguide/modifiers.html">
            
                
                    <a href="../refguide/modifiers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.7.</b>
                        
                        modifiers
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.8" data-path="refguide/observe.html">
            
                
                    <a href="../refguide/observe.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.8.</b>
                        
                        intercept &amp; observe
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.9" data-path="refguide/reaction.html">
            
                
                    <a href="../refguide/reaction.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.9.</b>
                        
                        reaction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.10" data-path="refguide/spy.html">
            
                
                    <a href="../refguide/spy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.10.</b>
                        
                        spy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.11" data-path="refguide/tojson.html">
            
                
                    <a href="../refguide/tojson.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.11.</b>
                        
                        toJS
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.12" data-path="refguide/transaction.html">
            
                
                    <a href="../refguide/transaction.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.12.</b>
                        
                        transaction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.13" data-path="refguide/untracked.html">
            
                
                    <a href="../refguide/untracked.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.13.</b>
                        
                        untracked
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.14" data-path="refguide/when.html">
            
                
                    <a href="../refguide/when.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.14.</b>
                        
                        when
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="donating.html">
            
                
                    <a href="../donating.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Donate
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >MobX</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <html><head></head><body><a id="edit-link" href="https://github.com/lutece/mobx/tree/gh-pages/docs/best/actions.md" class="btn fa fa-edit pull-left">&#xA0;&#xA0;Edit This Page</a><h1 id="writing-asynchronous-actions"><a name="writing-asynchronous-actions" class="plugin-anchor" href="#writing-asynchronous-actions"><span class="fa fa-link"></span></a>Writing asynchronous actions</h1>
<p>The <code>action</code> wrapper / decorator only affects the currently running function, not functions that are scheduled (but not invoked) by the current function!
This means that if you have a <code>setTimeout</code>, promise<code>.then</code> or <code>async</code> construction, and in that callback some more state is changed, those callbacks should be wrapped in <code>action</code> as well! There are several ways to create asynchronous actions. No approach is strictly better then the other, but this section just list different approaches you can take to writing asynchronous code.
Let&apos;s start with a basic example:</p>
<h3 id="promises"><a name="promises" class="plugin-anchor" href="#promises"><span class="fa fa-link"></span></a>Promises</h3>
<pre><code class="lang-javascript">mobx.useStrict(<span class="hljs-literal">true</span>) <span class="hljs-comment">// don&apos;t allow state modifications outside actions</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Store</span> </span>{
    @observable githubProjects = []
    @observable state = <span class="hljs-string">&quot;pending&quot;</span> <span class="hljs-comment">// &quot;pending&quot; / &quot;done&quot; / &quot;error&quot;</span>

    @action
    fetchProjects() {
        <span class="hljs-keyword">this</span>.githubProjects = []
        <span class="hljs-keyword">this</span>.state = <span class="hljs-string">&quot;pending&quot;</span>
        fetchGithubProjectsSomehow().then(
            projects =&gt; {
                <span class="hljs-keyword">const</span> filteredProjects = somePreprocessing(projects)
                <span class="hljs-keyword">this</span>.githubProjects = filteredProjects
                <span class="hljs-keyword">this</span>.state = <span class="hljs-string">&quot;done&quot;</span>
            },
            error =&gt; {
                <span class="hljs-keyword">this</span>.state = <span class="hljs-string">&quot;error&quot;</span>
            }
        )
    }
}
</code></pre>
<p>The above example would throw exceptions, as the callbacks passed to the <code>fethGithubProjectsSomehow</code> promise are not part of the <code>fetchProjects</code> action, as actions only apply to the current stack.</p>
<p>A first simple fix is to extract the callbacks to actions. (Note that binding is important here to get a correct <code>this</code>!):</p>
<pre><code class="lang-javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Store</span> </span>{
    @observable githubProjects = []
    @observable state = <span class="hljs-string">&quot;pending&quot;</span> <span class="hljs-comment">// &quot;pending&quot; / &quot;done&quot; / &quot;error&quot;</span>

    @action
    fetchProjects() {
        <span class="hljs-keyword">this</span>.githubProjects = []
        <span class="hljs-keyword">this</span>.state = <span class="hljs-string">&quot;pending&quot;</span>
        fetchGithubProjectsSomehow().then(<span class="hljs-keyword">this</span>.fetchProjectsSuccess, <span class="hljs-keyword">this</span>.fetchProjectsError)
    }

    @action.bound <span class="hljs-comment">// callback action</span>
    fetchProjectsSuccess(projects) {
        <span class="hljs-keyword">const</span> filteredProjects = somePreprocessing(projects)
        <span class="hljs-keyword">this</span>.githubProjects = filteredProjects
        <span class="hljs-keyword">this</span>.state = <span class="hljs-string">&quot;done&quot;</span>
    }

    @action.bound <span class="hljs-comment">// callback action</span>
    fetchProjectsError(error) {
        <span class="hljs-keyword">this</span>.state = <span class="hljs-string">&quot;error&quot;</span>
    }
}
</code></pre>
<p>Although this is clean and explicit, it might get a bit verbose with complex async flows. Alternative, you can wrap the promise callbacks with the <code>action</code> keyword. It is recommended, but not mandatory, to give them a name as well:</p>
<pre><code class="lang-javascript">mobx.useStrict(<span class="hljs-literal">true</span>) <span class="hljs-comment">// don&apos;t allow state modifications outside actions</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Store</span> </span>{
    @observable githubProjects = []
    @observable state = <span class="hljs-string">&quot;pending&quot;</span> <span class="hljs-comment">// &quot;pending&quot; / &quot;done&quot; / &quot;error&quot;</span>

    @action
    fetchProjects() {
        <span class="hljs-keyword">this</span>.githubProjects = []
        <span class="hljs-keyword">this</span>.state = <span class="hljs-string">&quot;pending&quot;</span>
        fetchGithubProjectsSomehow().then(
            <span class="hljs-comment">// inline created action</span>
            action(<span class="hljs-string">&quot;fetchSuccess&quot;</span>, projects =&gt; {
                <span class="hljs-keyword">const</span> filteredProjects = somePreprocessing(projects)
                <span class="hljs-keyword">this</span>.githubProjects = filteredProjects
                <span class="hljs-keyword">this</span>.state = <span class="hljs-string">&quot;done&quot;</span>
            }),
            <span class="hljs-comment">// inline created action</span>
            action(<span class="hljs-string">&quot;fetchError&quot;</span>, error =&gt; {
                <span class="hljs-keyword">this</span>.state = <span class="hljs-string">&quot;error&quot;</span>
            })
        )
    }
}
</code></pre>
<h3 id="the-runinaction-utility"><a name="the-runinaction-utility" class="plugin-anchor" href="#the-runinaction-utility"><span class="fa fa-link"></span></a>The <code>runInAction</code> utility</h3>
<p>A downside of inline actions is that TypeScript does not apply type inference on them, so you would have type all your callbacks.
Instead of creating an action for the entire callback, you can also run only the state modifying part of the callback in an action.
The advantage of this pattern is that it encourages you to not litter the place with <code>action</code>, but rather put all the state modifications as much as possible at the end of the whole process:</p>
<pre><code class="lang-javascript">mobx.useStrict(<span class="hljs-literal">true</span>) <span class="hljs-comment">// don&apos;t allow state modifications outside actions</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Store</span> </span>{
    @observable githubProjects = []
    @observable state = <span class="hljs-string">&quot;pending&quot;</span> <span class="hljs-comment">// &quot;pending&quot; / &quot;done&quot; / &quot;error&quot;</span>

    @action
    fetchProjects() {
        <span class="hljs-keyword">this</span>.githubProjects = []
        <span class="hljs-keyword">this</span>.state = <span class="hljs-string">&quot;pending&quot;</span>
        fetchGithubProjectsSomehow().then(
            projects =&gt; {
                <span class="hljs-keyword">const</span> filteredProjects = somePreprocessing(projects)
                <span class="hljs-comment">// put the &apos;final&apos; modification in an anonymous action</span>
                runInAction(() =&gt; {
                    <span class="hljs-keyword">this</span>.githubProjects = filteredProjects
                    <span class="hljs-keyword">this</span>.state = <span class="hljs-string">&quot;done&quot;</span>
                })
            },
            error =&gt; {
                <span class="hljs-comment">// the alternative ending of this process:...</span>
                runInAction(() =&gt; {
                    <span class="hljs-keyword">this</span>.state = <span class="hljs-string">&quot;error&quot;</span>
                })
            }
        )
    }
}
</code></pre>
<p>Note that <code>runInAction</code>&apos;s can also be given a name as first argument. <code>runInAction(f)</code> is in fact just sugar for <code>action(f)()</code></p>
<h3 id="async-await"><a name="async-await" class="plugin-anchor" href="#async-await"><span class="fa fa-link"></span></a>async / await</h3>
<p>Async / await based functions can initially seem confusing when starting with actions.
Because lexically they appear to synchronous functions, it gives the impression that <code>@action</code> applies to the entire function.
Which is of course not the case, as async / await is just syntactic sugar around a promise based process.
As a result, <code>@action</code> only applies to the code block until the first <code>await</code>.
And after each <code>await</code> a new asynchronous function is started, so after each <code>await</code>, state modifying code should be wrapped as action.
This is where <code>runInAction</code> comes in handy again:</p>
<pre><code class="lang-javascript">mobx.useStrict(<span class="hljs-literal">true</span>) <span class="hljs-comment">// don&apos;t allow state modifications outside actions</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Store</span> </span>{
    @observable githubProjects = []
    @observable state = <span class="hljs-string">&quot;pending&quot;</span> <span class="hljs-comment">// &quot;pending&quot; / &quot;done&quot; / &quot;error&quot;</span>

    @action
    <span class="hljs-keyword">async</span> fetchProjects() {
        <span class="hljs-keyword">this</span>.githubProjects = []
        <span class="hljs-keyword">this</span>.state = <span class="hljs-string">&quot;pending&quot;</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> projects = <span class="hljs-keyword">await</span> fetchGithubProjectsSomehow()
            <span class="hljs-keyword">const</span> filteredProjects = somePreprocessing(projects)
            <span class="hljs-comment">// after await, modifying state again, needs an actions:</span>
            runInAction(() =&gt; {
                <span class="hljs-keyword">this</span>.state = <span class="hljs-string">&quot;done&quot;</span>
                <span class="hljs-keyword">this</span>.githubProjects = filteredProjects
            })
        } <span class="hljs-keyword">catch</span> (error) {
            runInAction(() =&gt; {
                <span class="hljs-keyword">this</span>.state = <span class="hljs-string">&quot;error&quot;</span>
            })
        }
    }
}
</code></pre>
<h3 id="babel-plugin-mobx-deep-action"><a name="babel-plugin-mobx-deep-action" class="plugin-anchor" href="#babel-plugin-mobx-deep-action"><span class="fa fa-link"></span></a>babel-plugin-mobx-deep-action</h3>
<p>If you use babel, there is a plugin that scans for <code>@action</code> methods and automatically wraps all callbacks and await statements properly in actions during transpilation: <a href="https://github.com/mobxjs/babel-plugin-mobx-deep-action" target="_blank">mobx-deep-action</a>.</p>
<h3 id="generators-asyncaction"><a name="generators-asyncaction" class="plugin-anchor" href="#generators-asyncaction"><span class="fa fa-link"></span></a>Generators &amp; asyncAction</h3>
<p>Finally there is the <code>asyncAction</code> utility in the <a href="https://github.com/mobxjs/mobx-utils" target="_blank"><code>mobx-utils</code> package</a> that uses generators behind the scenes to automatically wrap yielded promises in actions. The advantage of this is that it is syntactically very close to async / await (with different keywords), and no manually action wrapping is needed for async parts, resulting in very clean code.
Just make sure every <code>yield</code> returns a promise.</p>
<p><code>asyncAction</code> can be used as decorator and as function (just like <code>@action</code>).
<code>asyncAction</code> integrates neatly with MobX development tools, so that it is easy to trace the process of the async function.
For more details see the docs of <a href="https://github.com/mobxjs/mobx-utils#asyncaction" target="_blank">asyncAction</a>.</p>
<pre><code class="lang-javascript">import {asyncAction} from &quot;mobx-utils&quot;

mobx.useStrict(true) // don&apos;t allow state modifications outside actions

class Store {
    @observable githubProjects = []
    @observable state = &quot;pending&quot; // &quot;pending&quot; / &quot;done&quot; / &quot;error&quot;

    @asyncAction
    *fetchProjects() { // &lt;- note the star, this a generator function!
        this.githubProjects = []
        this.state = &quot;pending&quot;
        try {
            const projects = yield fetchGithubProjectsSomehow() // yield instead of await
            const filteredProjects = somePreprocessing(projects)
            // the asynchronous blocks will automatically be wrapped actions
            this.state = &quot;done&quot;
            this.githubProjects = filteredProjects
        } catch (error) {
            this.state = &quot;error&quot;
        }
    }
}
</code></pre>
</body></html>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../best/store.html" class="navigation navigation-prev " aria-label="Previous page: Defining data stores"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../best/react-performance.html" class="navigation navigation-next " aria-label="Next page: Optimizing React components"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-github/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-ga/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-disqus/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-edit-link/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"github":{"url":"https://github.com/lutece/mobx"},"edit-link":{"base":"https://github.com/lutece/mobx/tree/gh-pages/docs","label":"Edit This Page"},"ga":{"token":"UA-65632006-1","configuration":"auto"},"disqus":{"shortName":"mobservable"}};
    gitbook.start(config);
});
</script>

        <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-65632006-1', 'auto');ga('send', 'pageview');</script>
    </body>
    
</html>
